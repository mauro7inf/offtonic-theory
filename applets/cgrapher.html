<?php
error_reporting(E_ALL);

require($_SERVER['DOCUMENT_ROOT'] . '/theory/book.php');
?>

<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8" />
		<meta name="description" content="Offtonic Theory by Mauro Braunstein" />
		<meta name="keywords" content="music theory, sightsinging, mathematics, complex analysis, polar, graph, rational function, complex numbers. color graph" />
		<title>Offtonic ℂ-Grapher</title>
		<link rel="icon" href="../favicon.ico" type="image/x-icon" />
		<link href="../theory.css" rel="stylesheet" type="text/css" />
		<script src="../lib/complex.js"></script>
		<script src="../lib/canvasButton.js"></script>
		<script src="../lib/cgrapher.js"></script>
		<script src="../lib/applets/cgrapher.js"></script>
	</head>
	<body class="applet" onload="load();">
		<div class="outer-container"><div class="inner-container">
			<h1 class="applet-title">Offtonic ℂ-Grapher</h1>
			<div class="cgrapher" id="cgrapher"></div>
			<? backToBook(); ?>
			<p class="text">This is the Offtonic ℂ-Grapher.  You can type in a function of z in the box and it will display a graph of that function using <a href="https://en.wikipedia.org/wiki/Domain_coloring">domain coloring</a>.  The function can have numbers, +, -, *, and / signs for addition, subtraction, multiplication, and division, ^ signs for exponentiation, e, i, tau, pi, and π as constants, as well as functions exp(), ln(), sin(), cos(), tan(), csc(), sec(), cot(), ' for complex conjugate, and, of course, ( and ) for grouping.  You don't need to use * for multiplication, so you can write z<sup>2</sup> as zz, for example, but be careful because this type of multiplication has higher precedence than the *, /, and ^ signs.  This means that if you write 1/2z, this will be interpreted as 1/(2z) rather than (1/2)*z, which is probably the behavior you expected, but it also means that 2z^2i will be interpreted as (2z)^(2i) rather than 2*z^(2i) or 2*(z^2)*i, which might throw you off.</p>
			<h4 class="question">Why?  What on Earth does this have to do with music theory?</h4>
			<p class="text">It might be useful if you're analyzing digital filters?  You can use this to visualize the zeros and poles of the transfer function for the filter as well as get a quick graph of the frequency response.</p>
			<h4 class="question">Fair enough.  So why is your math wrong?</h4>
			<p class="text">Behavior at infinity is hard to get right with simple —</p>
			<h4 class="question">No, no.  Order of operations.  There's an order of operations and you did it wrong.  1/2z = (1/2)*z, not 1/(2z).  Everyone knows that.</h4>
			<p class="text">Oh, that.  Yeah, so, no.  The first part of order of operations to evaluate the parentheses, right?  That actually refers to all grouping symbols, including fraction bars, root signs, etc.  The thing is, we humans have gotten pretty used to one particular grouping symbol: the lack of space.  When I put letters together, like "so", you read that as one word, "so", not two distinct letters, "s" and "o", multiplied together.  In addition, when you write a fraction in a more graphically capable manner, like on paper, you use a horizontal fraction bar, with 1 on the top and 2z on the bottom.  The way you might naively translate that to a line of text is generally to just write it down as is, 1/2z, instead of adding parentheses, but now this is ambiguous: is it (1/2)z or 1/(2z)?  Thing is, you almost certainly meant the latter, not the former, because if you had meant (1/2)z, you would have added a symbol or a space between the 2 and the z.  The precedence over exponents is a bit harder to justify, so I may change that.  Note that actual spaces are completely ignored (except to break up tokens), so "z&nbsp;&nbsp;&nbsp;z" is the same as "zz", but "2 2" is 2*2 and not 22.</p>
			<h4 class="question">What do the colors mean?</h4>
			<p class="text">If you look at the axes, the point where they cross represents the number 0 on the complex plane.  Of course.  The double circle, though, is the position of the unit circle, where |z| = 1.  This way, every point in the plane represents a complex number z.  The Offtonic ℂ-Grapher then calculates f(z) using the formula you provide in the box up top, and it colors that point on the plane according to f(z).  The hue — from red to yellow to green to cyan to blue to magenta back to red — represents the angle that f(z) makes with the positive real axis.  This means that positive real numbers are red, positive imaginary numbers are yellow-green, negative real numbers are cyan, negative imaginary numbers are purple, and all the angles in between are the colors in between.  If f(z) = 2, the point for z will be colored red since 2 is a positive real number; if f(z) = -1 - i, the point for z will be colored some shade of blue, since that's the color at that angle.  Then, the lightness of the color represents the magnitude of z, with 0 being black, 1 being the brightest colors, and ∞ being white.  The numbers in between get colored with shades in between.  If you have contours drawn, you'll see brighter lines at specific angles and specific magnitudes as a visual guide; magnitude 1 has a special highlight (well, the region around it is a bit darker).</p>
			<p class="text">Speaking of which, the outline of the graph is the color for f(∞), if it exists.  If it doesn't, there will hopefully be black and white stripes.  I say hopefully because I originally designed this to work with rational functions of z only, which are very well-behaved at ∞, but it becomes a lot harder when you have the complex conjugate operation running around.  Even ln breaks stuff a lot.  I <em>could</em> figure out what the behavior at ∞ is in these cases individually, but doing it generally is actually quite hard and would require a whole subsystem to do the necessary algebraic manipulation, and <em>that</em> is way out of scope.  So take the outline color with a grain of salt.</p>
			<h4 class="question">What's up with those buttons?</h4>
			<p class="text">The button on the left controls the zoom; you can zoom in or out to see more of the complex plane or more detail inside the unit circle (which is drawn on the graph).  The button on the right chooses the contours you'll see in the graph; you can independently choose the magnitude contours (the circles) and the angle contours (the radial lines).  The angle contours are at every π/12 radians starting at 0, and the magnitude contours are every decibel; to convert a (positive) number |z| to decibels, the formula is db = 10·log|z|/log(10).</p>
			<p class="text">The graph below is what we call the <em>frequency response</em>: it's the value of f(z) along the unit circle, with the horizontal axis being position along the circle (the center is at π radians, so the thin lines are π/8) and the vertical being magnitude (center is 1, thin lines represent multiplying or dividing the magnitude by 2, which is about 3db).  The color, of course, represents the angle, also known as the <em>phase response</em>.  I <em>could</em> plot the phase response in its own separate graph, but... it's really not all that important, so I won't.</p>
			<p class="text">I hope you enjoy playing around with this grapher.  If you're new to complex analysis, let me show you something cool.  Type in a rational function, like (1+zz)/(1-zz).  You see how it's got black spots at ±i and white spots at ±1?  The black spots represent zeros, where the numerator is 0, and the white spots represent poles, where the denominator is 0.  The angle contours all start at a zero and end at a pole (well, they don't have direction specifically), and the magnitude contours all go around the zeros and poles.  This is true for any function that is smooth enough.</p>
			<h4 class="question">What kind of function is not smooth enough?</h4>
			<p class="text">Ah, great question.  If you plot ln(z), you'll notice that the color radically changes from yellow-green to purple when you cross the negative real axis.  You'll also notice that the contours stop there, too.  Let's do the math and you'll see why!  You can represent any complex number as r·e<sup>i·ø</sup>, where r is the distance from 0 and ø is the angle from the positive real axis.  Here, r is positive and ø is an angle.  If you take the ln of this, you get ln(r) + i·ø.  ln(r) is easy to understand since r is positive; this is your usual natural log.  But ø presents a problem, because ø, as an angle, goes from 0 to 2π, at which point it's actually the same angle as 0 again.  There's a discontinuity at 0 and 2π.  You may even want to let your angles actually go from –π to π instead.  Now the discontinuity is at π and –π.  It turns out that, if the angle is, say, 3π/2, –π/2 is also a valid angle for that point, as is –5π/2, 7π/2, etc., on and on in both directions.  The place in the complex plane at which the discontinuity happens is called a <em>branch cut</em>, and it's actually somewhat arbitrary.  My choice here is to make the cut on the negative real axis, where the angle skips from π to –π.  I could have made a different choice.  ln(z) is actually a <em>multi-valued function</em> (yes, such things exist in complex analysis), and outside of the essential singularities at 0 and ∞, it's perfectly smooth if you consider <em>all</em> the values of the multi-valued function.  But if we're plotting on a plane, we only get to pick one value at a time.  That's going to have a branch cut.  Branch cuts, by the way, start at one essential singularity and end at another.</p>
			<h4 class="question">What's an essential singularity?</h4>
			<p class="text">...</p>
			<p class="text">You know what, just play with the grapher, then take a course on complex analysis if you're interested.  It's fun stuff!</p>
		</div></div>
	</body>
</html>